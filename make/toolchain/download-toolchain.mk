include $(MAKE_DIR)/toolchain/kernel/ccache/ccache.mk
include $(MAKE_DIR)/toolchain/target/ccache/ccache.mk
include $(MAKE_DIR)/toolchain/target/libtool-staging/libtool-staging.mk
include $(MAKE_DIR)/toolchain/target/uclibc/uclibc.mk

ifeq ($(strip $(FREETZ_TOOLCHAIN_CCACHE)),y)
	CCACHE:=ccache-kernel ccache
endif

KERNEL_TOOLCHAIN_HASH:=$(call qstrip,$(FREETZ_DL_KERNEL_TOOLCHAIN_HASH))
KERNEL_TOOLCHAIN_VERSION:=$(call qstrip,$(FREETZ_DL_KERNEL_TOOLCHAIN_VERSION))
KERNEL_TOOLCHAIN_SUFFIX:=$(call qstrip,$(FREETZ_DL_TOOLCHAIN_SUFFIX))
KERNEL_TOOLCHAIN_SOURCE:=$(KERNEL_TOOLCHAIN_COMPILER)-freetz-$(KERNEL_TOOLCHAIN_VERSION)-$(KERNEL_TOOLCHAIN_SUFFIX).tar.lzma

TARGET_TOOLCHAIN_HASH:=$(call qstrip,$(FREETZ_DL_TARGET_TOOLCHAIN_HASH))
TARGET_TOOLCHAIN_VERSION:=$(call qstrip,$(FREETZ_DL_TARGET_TOOLCHAIN_VERSION))
TARGET_TOOLCHAIN_SUFFIX:=$(call qstrip,$(FREETZ_DL_TOOLCHAIN_SUFFIX))
TARGET_TOOLCHAIN_SOURCE:=$(TARGET_TOOLCHAIN_COMPILER)-freetz-$(TARGET_TOOLCHAIN_VERSION)-$(TARGET_TOOLCHAIN_SUFFIX).tar.lzma

KERNEL_TOOLCHAIN__ECHO_TYPE:=KTC
KERNEL_TOOLCHAIN__ECHO_MAKE:=precompiled

TARGET_TOOLCHAIN__ECHO_TYPE:=TTC
TARGET_TOOLCHAIN__ECHO_MAKE:=precompiled


$(KERNEL_TOOLCHAIN_DIR) $(TARGET_TOOLCHAIN_DIR):
	@mkdir -p $@

$(DL_DIR)/$(KERNEL_TOOLCHAIN_SOURCE): | $(DL_DIR)
	@$(call _ECHO,downloading,$(KERNEL_TOOLCHAIN__ECHO_TYPE),$(KERNEL_TOOLCHAIN__ECHO_MAKE))
	@$(DL_TOOL) $(DL_DIR) $(KERNEL_TOOLCHAIN_SOURCE) $(FREETZ_DL_TOOLCHAIN_SITE) $(KERNEL_TOOLCHAIN_HASH) $(SILENT)

$(DL_DIR)/$(TARGET_TOOLCHAIN_SOURCE): | $(DL_DIR)
	@$(call _ECHO,downloading,$(KERNEL_TOOLCHAIN__ECHO_TYPE),$(TARGET_TOOLCHAIN__ECHO_MAKE))
	@$(DL_TOOL) $(DL_DIR) $(TARGET_TOOLCHAIN_SOURCE) $(FREETZ_DL_TOOLCHAIN_SITE) $(TARGET_TOOLCHAIN_HASH) $(SILENT)

download-toolchain: \
		$(KERNEL_CROSS_COMPILER) kernel-configured \
		$(TARGET_CROSS_COMPILER) target-toolchain-kernel-headers $(TARGET_SPECIFIC_ROOT_DIR)$(UCLIBC_TARGET_SUBDIR)/libc.so.$(TARGET_TOOLCHAIN_UCLIBC_MAJOR_VERSION) \
		$(CCACHE) \
		$(STDCXXLIB) $(TARGET_CXX_CROSS_COMPILER_SYMLINK_TIMESTAMP) \
		libtool-staging \
		$(if $(FREETZ_PACKAGE_GDB_HOST),gdbhost)

gcc-kernel: $(KERNEL_CROSS_COMPILER)
$(KERNEL_CROSS_COMPILER): $(DL_DIR)/$(KERNEL_TOOLCHAIN_SOURCE) | $(TOOLCHAIN_BUILD_DIR) $(KERNEL_TOOLCHAIN_SYMLINK_DOT_FILE) $(UNPACK_TARBALL_PREREQUISITES)
	@$(call _ECHO,preparing,$(KERNEL_TOOLCHAIN__ECHO_TYPE),$(KERNEL_TOOLCHAIN__ECHO_MAKE))
	$(RM) -r $(TOOLCHAIN_BUILD_DIR)/$(KERNEL_TOOLCHAIN_COMPILER)
	$(call UNPACK_TARBALL,$(DL_DIR)/$(KERNEL_TOOLCHAIN_SOURCE),$(TOOLCHAIN_BUILD_DIR))
	@touch $@

gcc: $(TARGET_CROSS_COMPILER)
$(TARGET_CROSS_COMPILER): $(DL_DIR)/$(TARGET_TOOLCHAIN_SOURCE) | $(TOOLCHAIN_BUILD_DIR) $(TARGET_TOOLCHAIN_SYMLINK_DOT_FILE) $(UNPACK_TARBALL_PREREQUISITES)
	@$(call _ECHO,preparing,$(TARGET_TOOLCHAIN__ECHO_TYPE),$(TARGET_TOOLCHAIN__ECHO_MAKE))
	$(RM) -r $(TOOLCHAIN_BUILD_DIR)/$(TARGET_TOOLCHAIN_COMPILER)
	$(call UNPACK_TARBALL,$(DL_DIR)/$(TARGET_TOOLCHAIN_SOURCE),$(TOOLCHAIN_BUILD_DIR))
	@touch $@


download-toolchain-clean:

download-toolchain-dirclean: kernel-toolchain-dirclean target-toolchain-dirclean

download-toolchain-distclean: kernel-toolchain-distclean target-toolchain-distclean

kernel-toolchain-dirclean:

target-toolchain-dirclean:


.PHONY: gcc-kernel gcc

